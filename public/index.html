<!DOCTYPE html>
<html>
<head>
	<title>Do</title>
    <meta name="viewport" content="width=device-width, user-scalable=no">
    <link rel="stylesheet" type="text/css" href="css/style.css">
</head>
<body>
	<h1>Do</h1>
	<form method="post">
		<h2>First Thing</h2>
		<input type="hidden" name="id" value="1">
		<input type="submit" value="done">
	</form>

	<form method="post">
		<h2>Second Thing</h2>
		<input type="hidden" name="id" value="2">
		<input type="submit" value="done">
	</form>

	<form method="post">
		<h2>Third Thing</h2>
		<input type="hidden" name="id" value="3">
		<input type="submit" value="done">
	</form>

	<form method="post">
		<h2>Fourth Thing</h2>
		<input type="hidden" name="id" value="4">
		<input type="submit" value="done">
	</form>


	<form method="post">
		<h2>Fifth Thing</h2>
		<input type="hidden" name="id" value="5">
		<input type="submit" value="done">
	</form>


	<script src="http://cdn.pubnub.com/pubnub.min.js" ></script>
	<script src="reqwest.js" ></script>
	<script>(function(){

		var pubnub = PUBNUB.init({
			subscribe_key : 'demo'
		})

		pubnub.subscribe({
			channel : "do_channel",
			message : function(m){

				console.log(m);

				var buttons = document.querySelectorAll('[name=id]');
				var button;

				[].some.call(buttons, function(b){
					if(b.value == m.did) return (button = b);
				});

				var classes = button.parentElement.classList;
				classes.add('triggered');
				setTimeout(function(){
					classes.remove('triggered');
				},1000);

			},
		})

		// submit with ajax instead
		document.addEventListener('submit', function(e){
			e.preventDefault();

			var idvalue = e.target.querySelector('[name=id]').value;

			reqwest({
				url: '/'
				, method: 'post'
				, data: { id: idvalue }
				, success: function (resp) {}
			});


		}, true);

	 })();</script>
</body>
</html>
